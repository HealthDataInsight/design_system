@use "../../core/settings" as *;
@use "../../core/tools" as *;

////
/// Details component
///
/// 1. Style the summary to look like a link...
/// 2. Make the focus outline shrink-wrap the text content of the summary
/// 3. Absolutely position the marker against this element
/// 3. Allow for absolutely positioned marker and align with disclosed text
/// 4. Only underline the text, not the arrow
/// 5. Remove the default details marker so we can style our own consistently and
///    ensure it displays in Firefox
/// 6. Custom padding to left align the details text with the summary
///
/// @group components
/// @link https://github.com/alphagov/govuk-frontend Original code taken from GDS (Government Digital Service)
////

.ndrsuk-details {
  display: block;
  @include ndrsuk-text-color;
  @include ndrsuk-font-size(19);
  @include ndrsuk-responsive-margin(4, "bottom");
}

.ndrsuk-details__summary {
  color: $color_ndrsuk-blue; // [1]
  cursor: pointer;
  display: inline-block; // [2]
  padding-left: ndrsuk-spacing(4);
  position: relative; // [3]

  &:hover {
    color: $ndrsuk-link-hover-color;
  }

  &::before {
    bottom: 0;
    content: "";
    left: 0;
    margin: auto;
    position: absolute;
    top: 0;

    @include ndrsuk-shape-arrow($direction: right, $base: 14px);
  }

  &:focus {
    @include ndrsuk-focused-text;
  }

  &:hover,
  &:focus {
    .ndrsuk-details__summary-text {
      text-decoration: none;
    }
  }
}

.ndrsuk-details[open] > .ndrsuk-details__summary::before {
  @include ndrsuk-shape-arrow($direction: down, $base: 14px);
}

.ndrsuk-details__summary-text {
  text-decoration: underline; // [4]
}

.ndrsuk-details__summary::-webkit-details-marker {
  display: none; // [5]
}

.ndrsuk-details__text {
  border-left: ndrsuk-spacing(1) solid $color_ndrsuk-grey-4;
  margin-top: ndrsuk-spacing(2);
  padding: ndrsuk-spacing(3);
  padding-left: 20px; // [6]
  @include ndrsuk-top-and-bottom;
}

/// Expander variation.
///
/// 1. !important used because the icon is populated
///    by the JavaScript polyfill
/// 2. Remove the default hover, focus and active
///    styles for this component.
/// 3. -2px left margin to align the icon to the content.
/// 4. When a group of details is used reduce the
///    margin between them so they sit together.

$expander-border-width: 1px;
$expander-border-bottom-width: ndrsuk-spacing(1);
$expander-border-color: $color_ndrsuk-grey-4;
$expander-border-hover-color: $color_ndrsuk-grey-3;

.ndrsuk-expander {
  background-color: $color_ndrsuk-white;
  border: $expander-border-width solid $expander-border-color;
  border-bottom-width: $expander-border-bottom-width;

  &:hover {
    border-color: $expander-border-hover-color;
  }

  .ndrsuk-details__summary {
    background-color: $color_ndrsuk-white;
    border-top: $ndrsuk-focus-width solid transparent;
    display: block;
    padding: ndrsuk-spacing(5) - $ndrsuk-focus-width ndrsuk-spacing(5) ndrsuk-spacing(5);

    @include ndrsuk-media-query($until: tablet) {
      padding: ndrsuk-spacing(4) - $ndrsuk-focus-width ndrsuk-spacing(4) ndrsuk-spacing(4);
    }

    &::before {
      // stylelint-disable-next-line declaration-no-important
      display: none !important; // [1]
    }

    &:hover {
      .ndrsuk-details__summary-text {
        color: $ndrsuk-link-hover-color;
      }
    }

    &:focus {
      box-shadow: none;

      .ndrsuk-details__summary-text {
        @include ndrsuk-focused-text;
      }

      .ndrsuk-details__summary-text::before {
        background: $ndrsuk-focus-color
          url("data:image/svg+xml,%3Csvg class='ndrsuk-icon ndrsuk-icon__plus' xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' aria-hidden='true'%3E%3Ccircle cx='12' cy='12' r='10' fill='002f5c'%3E%3C/circle%3E%3Cpath fill='none' stroke='%23fff' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M12 8v8M8 12h8'%3E%3C/path%3E%3C/svg%3E%0A")
          left -2px center no-repeat;
      }
    }
  }

  .ndrsuk-details__summary-text {
    color: $color_ndrsuk-blue;
    cursor: pointer;
    display: inline-block;
    padding: ndrsuk-spacing(1) ndrsuk-spacing(1) ndrsuk-spacing(1) 38px;
    position: relative;
  }

  .ndrsuk-details__summary-text::before {
    background: url("data:image/svg+xml,%3Csvg class='ndrsuk-icon ndrsuk-icon__plus' xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' aria-hidden='true'%3E%3Ccircle cx='12' cy='12' r='10' fill='%23005eb8'%3E%3C/circle%3E%3Cpath fill='none' stroke='%23fff' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M12 8v8M8 12h8'%3E%3C/path%3E%3C/svg%3E%0A")
      left -2px center no-repeat;
    content: "";
    display: inline-block;
    height: 32px;
    left: 0;
    position: absolute;
    top: calc(50% - 16px);
    width: 32px;
  }

  .ndrsuk-details__text {
    border-left: 0;
    margin-left: 0;
    margin-top: 0;

    @include ndrsuk-responsive-padding(5, "bottom");
    @include ndrsuk-responsive-padding(5, "left");
    @include ndrsuk-responsive-padding(5, "right");
    @include ndrsuk-responsive-padding(0, "top");
  }
}

.ndrsuk-expander[open] {
  border-bottom-width: $expander-border-width;

  .ndrsuk-details__summary {
    &:focus {
      &:hover {
        .ndrsuk-details__summary-text {
          text-decoration: none;
        }
      }

      .ndrsuk-details__summary-text::before {
        background: $ndrsuk-focus-color
          url("data:image/svg+xml,%3Csvg class='ndrsuk-icon ndrsuk-icon__minus' xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' aria-hidden='true'%3E%3Ccircle cx='12' cy='12' r='10' fill='002f5c'%3E%3C/circle%3E%3Cpath fill='none' stroke='%23fff' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M8 12h8'%3E%3C/path%3E%3C/svg%3E%0A")
          left -2px center no-repeat; // [3]
      }
    }
  }

  .ndrsuk-details__summary-text::before {
    background: url("data:image/svg+xml,%3Csvg class='ndrsuk-icon ndrsuk-icon__minus' xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' aria-hidden='true'%3E%3Ccircle cx='12' cy='12' r='10' fill='%23005eb8'%3E%3C/circle%3E%3Cpath fill='none' stroke='%23fff' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M8 12h8'%3E%3C/path%3E%3C/svg%3E%0A")
      left -2px center no-repeat; // [3]
  }
}

.ndrsuk-expander-group {
  // [4]

  @include ndrsuk-responsive-margin(4, "bottom");

  > .ndrsuk-details {
    @include ndrsuk-responsive-margin(2, "bottom");
  }
}

.ndrsuk-details + h2,
.ndrsuk-details + .ndrsuk-heading-l {
  @include ndrsuk-responsive-padding(4, "top");
}
